var yt=Object.defineProperty;var qe=e=>{throw TypeError(e)};var xt=(e,t,r)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>xt(e,typeof t!="symbol"?t+"":t,r),Ce=(e,t,r)=>t.has(e)||qe("Cannot "+r);var c=(e,t,r)=>(Ce(e,t,"read from private field"),r?r.call(e):t.get(e)),g=(e,t,r)=>t.has(e)?qe("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),f=(e,t,r,s)=>(Ce(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),E=(e,t,r)=>(Ce(e,t,"access private method"),r);var Le=(e,t,r,s)=>({set _(n){f(e,t,n,r)},get _(){return c(e,t,s)}});var Fe=(e,t,r)=>(s,n)=>{let i=-1;return a(0);async function a(l){if(l<=i)throw new Error("next() called multiple times");i=l;let o,d=!1,h;if(e[l]?(h=e[l][0][0],s.req.routeIndex=l):h=l===e.length&&n||void 0,h)try{o=await h(s,()=>a(l+1))}catch(u){if(u instanceof Error&&t)s.error=u,o=await t(u,s),d=!0;else throw u}else s.finalized===!1&&r&&(o=await r(s));return o&&(s.finalized===!1||d)&&(s.res=o),s}},Rt=Symbol(),bt=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof nt?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?_t(e,{all:r,dot:s}):{}};async function _t(e,t){const r=await e.formData();return r?jt(r,t):{}}function jt(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Ot(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(Tt(r,s,n),delete r[s])}),r}var Ot=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},Tt=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},Ze=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},St=e=>{const{groups:t,path:r}=At(e),s=Ze(r);return Ct(s,t)},At=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},Ct=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},xe={},Dt=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return xe[s]||(r[2]?xe[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:xe[s]=[e,r[1],!0]),xe[s]}return null},He=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Pt=e=>He(e,decodeURI),et=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return Pt(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)},It=e=>{const t=et(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},re=(e,t,...r)=>(r.length&&(t=re(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),tt=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},De=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?He(e,st):e):e,rt=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){const l=e.charCodeAt(a+t.length+1);if(l===61){const o=a+t.length+2,d=e.indexOf("&",o);return De(e.slice(o,d===-1?void 0:d))}else if(l==38||isNaN(l))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let l=e.indexOf("=",i);l>a&&a!==-1&&(l=-1);let o=e.slice(i+1,l===-1?a===-1?void 0:a:l);if(s&&(o=De(o)),i=a,o==="")continue;let d;l===-1?d="":(d=e.slice(l+1,a===-1?void 0:a),s&&(d=De(d))),r?(n[o]&&Array.isArray(n[o])||(n[o]=[]),n[o].push(d)):n[o]??(n[o]=d)}return t?n[t]:n},Nt=rt,Ht=(e,t)=>rt(e,t,!0),st=decodeURIComponent,$e=e=>He(e,st),ie,A,F,it,at,Ie,B,ke,nt=(ke=class{constructor(e,t="/",r=[[]]){g(this,F);p(this,"raw");g(this,ie);g(this,A);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});g(this,B,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,f(this,A,r),f(this,ie,{})}param(e){return e?E(this,F,it).call(this,e):E(this,F,at).call(this)}query(e){return Nt(this.url,e)}queries(e){return Ht(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await bt(this,e))}json(){return c(this,B).call(this,"text").then(e=>JSON.parse(e))}text(){return c(this,B).call(this,"text")}arrayBuffer(){return c(this,B).call(this,"arrayBuffer")}blob(){return c(this,B).call(this,"blob")}formData(){return c(this,B).call(this,"formData")}addValidatedData(e,t){c(this,ie)[e]=t}valid(e){return c(this,ie)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[Rt](){return c(this,A)}get matchedRoutes(){return c(this,A)[0].map(([[,e]])=>e)}get routePath(){return c(this,A)[0].map(([[,e]])=>e)[this.routeIndex].path}},ie=new WeakMap,A=new WeakMap,F=new WeakSet,it=function(e){const t=c(this,A)[0][this.routeIndex][1][e],r=E(this,F,Ie).call(this,t);return r&&/\%/.test(r)?$e(r):r},at=function(){const e={},t=Object.keys(c(this,A)[0][this.routeIndex][1]);for(const r of t){const s=E(this,F,Ie).call(this,c(this,A)[0][this.routeIndex][1][r]);s!==void 0&&(e[r]=/\%/.test(s)?$e(s):s)}return e},Ie=function(e){return c(this,A)[1]?c(this,A)[1][e]:e},B=new WeakMap,ke),Mt={Stringify:1},ot=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(n?n[0]+=e:n=[e],Promise.all(i.map(l=>l({phase:t,buffer:n,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(o=>ot(o,t,!1,s,n))).then(()=>n[0]))):Promise.resolve(e)},qt="text/plain; charset=UTF-8",Pe=(e,t)=>({"Content-Type":e,...t}),me,ge,H,ae,M,T,Ee,oe,ce,Y,ve,we,U,se,ze,Lt=(ze=class{constructor(e,t){g(this,U);g(this,me);g(this,ge);p(this,"env",{});g(this,H);p(this,"finalized",!1);p(this,"error");g(this,ae);g(this,M);g(this,T);g(this,Ee);g(this,oe);g(this,ce);g(this,Y);g(this,ve);g(this,we);p(this,"render",(...e)=>(c(this,oe)??f(this,oe,t=>this.html(t)),c(this,oe).call(this,...e)));p(this,"setLayout",e=>f(this,Ee,e));p(this,"getLayout",()=>c(this,Ee));p(this,"setRenderer",e=>{f(this,oe,e)});p(this,"header",(e,t,r)=>{this.finalized&&f(this,T,new Response(c(this,T).body,c(this,T)));const s=c(this,T)?c(this,T).headers:c(this,Y)??f(this,Y,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});p(this,"status",e=>{f(this,ae,e)});p(this,"set",(e,t)=>{c(this,H)??f(this,H,new Map),c(this,H).set(e,t)});p(this,"get",e=>c(this,H)?c(this,H).get(e):void 0);p(this,"newResponse",(...e)=>E(this,U,se).call(this,...e));p(this,"body",(e,t,r)=>E(this,U,se).call(this,e,t,r));p(this,"text",(e,t,r)=>!c(this,Y)&&!c(this,ae)&&!t&&!r&&!this.finalized?new Response(e):E(this,U,se).call(this,e,t,Pe(qt,r)));p(this,"json",(e,t,r)=>E(this,U,se).call(this,JSON.stringify(e),t,Pe("application/json",r)));p(this,"html",(e,t,r)=>{const s=n=>E(this,U,se).call(this,n,t,Pe("text/html; charset=UTF-8",r));return typeof e=="object"?ot(e,Mt.Stringify,!1,{}).then(s):s(e)});p(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});p(this,"notFound",()=>(c(this,ce)??f(this,ce,()=>new Response),c(this,ce).call(this,this)));f(this,me,e),t&&(f(this,M,t.executionCtx),this.env=t.env,f(this,ce,t.notFoundHandler),f(this,we,t.path),f(this,ve,t.matchResult))}get req(){return c(this,ge)??f(this,ge,new nt(c(this,me),c(this,we),c(this,ve))),c(this,ge)}get event(){if(c(this,M)&&"respondWith"in c(this,M))return c(this,M);throw Error("This context has no FetchEvent")}get executionCtx(){if(c(this,M))return c(this,M);throw Error("This context has no ExecutionContext")}get res(){return c(this,T)||f(this,T,new Response(null,{headers:c(this,Y)??f(this,Y,new Headers)}))}set res(e){if(c(this,T)&&e){e=new Response(e.body,e);for(const[t,r]of c(this,T).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=c(this,T).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}f(this,T,e),this.finalized=!0}get var(){return c(this,H)?Object.fromEntries(c(this,H)):{}}},me=new WeakMap,ge=new WeakMap,H=new WeakMap,ae=new WeakMap,M=new WeakMap,T=new WeakMap,Ee=new WeakMap,oe=new WeakMap,ce=new WeakMap,Y=new WeakMap,ve=new WeakMap,we=new WeakMap,U=new WeakSet,se=function(e,t,r){const s=c(this,T)?new Headers(c(this,T).headers):c(this,Y)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,l]of i)a.toLowerCase()==="set-cookie"?s.append(a,l):s.set(a,l)}if(r)for(const[i,a]of Object.entries(r))if(typeof a=="string")s.set(i,a);else{s.delete(i);for(const l of a)s.append(i,l)}const n=typeof t=="number"?t:(t==null?void 0:t.status)??c(this,ae);return new Response(e,{status:n,headers:s})},ze),R="ALL",Ft="all",$t=["get","post","put","delete","options","patch"],ct="Can not add a route since the matcher is already built.",lt=class extends Error{},Bt="__COMPOSED_HANDLER",Ut=e=>e.text("404 Not Found",404),Be=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},C,b,ht,D,K,Re,be,Ve,dt=(Ve=class{constructor(t={}){g(this,b);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");g(this,C,"/");p(this,"routes",[]);g(this,D,Ut);p(this,"errorHandler",Be);p(this,"onError",t=>(this.errorHandler=t,this));p(this,"notFound",t=>(f(this,D,t),this));p(this,"fetch",(t,...r)=>E(this,b,be).call(this,t,r[1],r[0],t.method));p(this,"request",(t,r,s,n)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,n):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${re("/",t)}`,r),s,n)));p(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(E(this,b,be).call(this,t.request,t,void 0,t.request.method))})});[...$t,Ft].forEach(i=>{this[i]=(a,...l)=>(typeof a=="string"?f(this,C,a):E(this,b,K).call(this,i,c(this,C),a),l.forEach(o=>{E(this,b,K).call(this,i,c(this,C),o)}),this)}),this.on=(i,a,...l)=>{for(const o of[a].flat()){f(this,C,o);for(const d of[i].flat())l.map(h=>{E(this,b,K).call(this,d.toUpperCase(),c(this,C),h)})}return this},this.use=(i,...a)=>(typeof i=="string"?f(this,C,i):(f(this,C,"*"),a.unshift(i)),a.forEach(l=>{E(this,b,K).call(this,R,c(this,C),l)}),this);const{strict:s,...n}=t;Object.assign(this,n),this.getPath=s??!0?t.getPath??et:It}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{var a;let i;r.errorHandler===Be?i=n.handler:(i=async(l,o)=>(await Fe([],r.errorHandler)(l,()=>n.handler(l,o))).res,i[Bt]=n.handler),E(a=s,b,K).call(a,n.method,n.path,i)}),this}basePath(t){const r=E(this,b,ht).call(this);return r._basePath=re(this._basePath,t),r}mount(t,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,s.replaceRequest===!1?n=o=>o:n=s.replaceRequest));const a=i?o=>{const d=i(o);return Array.isArray(d)?d:[d]}:o=>{let d;try{d=o.executionCtx}catch{}return[o.env,d]};n||(n=(()=>{const o=re(this._basePath,t),d=o==="/"?0:o.length;return h=>{const u=new URL(h.url);return u.pathname=u.pathname.slice(d)||"/",new Request(u,h)}})());const l=async(o,d)=>{const h=await r(n(o.req.raw),...a(o));if(h)return h;await d()};return E(this,b,K).call(this,R,re(t,"*"),l),this}},C=new WeakMap,b=new WeakSet,ht=function(){const t=new dt({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,f(t,D,c(this,D)),t.routes=this.routes,t},D=new WeakMap,K=function(t,r,s){t=t.toUpperCase(),r=re(this._basePath,r);const n={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)},Re=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},be=function(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await E(this,b,be).call(this,t,r,s,"GET")))();const i=this.getPath(t,{env:s}),a=this.router.match(n,i),l=new Lt(t,{path:i,matchResult:a,env:s,executionCtx:r,notFoundHandler:c(this,D)});if(a[0].length===1){let d;try{d=a[0][0][0][0](l,async()=>{l.res=await c(this,D).call(this,l)})}catch(h){return E(this,b,Re).call(this,h,l)}return d instanceof Promise?d.then(h=>h||(l.finalized?l.res:c(this,D).call(this,l))).catch(h=>E(this,b,Re).call(this,h,l)):d??c(this,D).call(this,l)}const o=Fe(a[0],this.errorHandler,c(this,D));return(async()=>{try{const d=await o(l);if(!d.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return d.res}catch(d){return E(this,b,Re).call(this,d,l)}})()},Ve),ut=[];function Wt(e,t){const r=this.buildAllMatchers(),s=(n,i)=>{const a=r[n]||r[R],l=a[2][i];if(l)return l;const o=i.match(a[0]);if(!o)return[[],ut];const d=o.indexOf("",1);return[a[1][d],o]};return this.match=s,s(e,t)}var je="[^/]+",fe=".*",pe="(?:|/.*)",ne=Symbol(),kt=new Set(".\\+*[^]$()");function zt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===fe||e===pe?1:t===fe||t===pe?-1:e===je?1:t===je?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var J,X,P,Ke,Ne=(Ke=class{constructor(){g(this,J);g(this,X);g(this,P,Object.create(null))}insert(t,r,s,n,i){if(t.length===0){if(c(this,J)!==void 0)throw ne;if(i)return;f(this,J,r);return}const[a,...l]=t,o=a==="*"?l.length===0?["","",fe]:["","",je]:a==="/*"?["","",pe]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let d;if(o){const h=o[1];let u=o[2]||je;if(h&&o[2]&&(u===".*"||(u=u.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(u))))throw ne;if(d=c(this,P)[u],!d){if(Object.keys(c(this,P)).some(m=>m!==fe&&m!==pe))throw ne;if(i)return;d=c(this,P)[u]=new Ne,h!==""&&f(d,X,n.varIndex++)}!i&&h!==""&&s.push([h,c(d,X)])}else if(d=c(this,P)[a],!d){if(Object.keys(c(this,P)).some(h=>h.length>1&&h!==fe&&h!==pe))throw ne;if(i)return;d=c(this,P)[a]=new Ne}d.insert(l,r,s,n,i)}buildRegExpStr(){const r=Object.keys(c(this,P)).sort(zt).map(s=>{const n=c(this,P)[s];return(typeof c(n,X)=="number"?`(${s})@${c(n,X)}`:kt.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof c(this,J)=="number"&&r.unshift(`#${c(this,J)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},J=new WeakMap,X=new WeakMap,P=new WeakMap,Ke),Oe,ye,Ge,Vt=(Ge=class{constructor(){g(this,Oe,{varIndex:0});g(this,ye,new Ne)}insert(e,t,r){const s=[],n=[];for(let a=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const d=`@\\${a}`;return n[a]=[d,o],a++,l=!0,d}),!l)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[l]=n[a];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(l)!==-1){i[o]=i[o].replace(l,n[a][1]);break}}return c(this,ye).insert(i,t,s,c(this,Oe),r),s}buildRegExp(){let e=c(this,ye).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Oe=new WeakMap,ye=new WeakMap,Ge),Kt=[/^$/,[],Object.create(null)],_e=Object.create(null);function ft(e){return _e[e]??(_e[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Gt(){_e=Object.create(null)}function Yt(e){var d;const t=new Vt,r=[];if(e.length===0)return Kt;const s=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,u],[m,x])=>h?1:m?-1:u.length-x.length),n=Object.create(null);for(let h=0,u=-1,m=s.length;h<m;h++){const[x,S,v]=s[h];x?n[S]=[v.map(([O])=>[O,Object.create(null)]),ut]:u++;let y;try{y=t.insert(S,u,x)}catch(O){throw O===ne?new lt(S):O}x||(r[u]=v.map(([O,ee])=>{const de=Object.create(null);for(ee-=1;ee>=0;ee--){const[I,Se]=y[ee];de[I]=Se}return[O,de]}))}const[i,a,l]=t.buildRegExp();for(let h=0,u=r.length;h<u;h++)for(let m=0,x=r[h].length;m<x;m++){const S=(d=r[h][m])==null?void 0:d[1];if(!S)continue;const v=Object.keys(S);for(let y=0,O=v.length;y<O;y++)S[v[y]]=l[S[v[y]]]}const o=[];for(const h in a)o[h]=r[a[h]];return[i,o,n]}function te(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(ft(r).test(t))return[...e[r]]}}var W,k,Te,pt,Ye,Jt=(Ye=class{constructor(){g(this,Te);p(this,"name","RegExpRouter");g(this,W);g(this,k);p(this,"match",Wt);f(this,W,{[R]:Object.create(null)}),f(this,k,{[R]:Object.create(null)})}add(e,t,r){var l;const s=c(this,W),n=c(this,k);if(!s||!n)throw new Error(ct);s[e]||[s,n].forEach(o=>{o[e]=Object.create(null),Object.keys(o[R]).forEach(d=>{o[e][d]=[...o[R][d]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=ft(t);e===R?Object.keys(s).forEach(d=>{var h;(h=s[d])[t]||(h[t]=te(s[d],t)||te(s[R],t)||[])}):(l=s[e])[t]||(l[t]=te(s[e],t)||te(s[R],t)||[]),Object.keys(s).forEach(d=>{(e===R||e===d)&&Object.keys(s[d]).forEach(h=>{o.test(h)&&s[d][h].push([r,i])})}),Object.keys(n).forEach(d=>{(e===R||e===d)&&Object.keys(n[d]).forEach(h=>o.test(h)&&n[d][h].push([r,i]))});return}const a=tt(t)||[t];for(let o=0,d=a.length;o<d;o++){const h=a[o];Object.keys(n).forEach(u=>{var m;(e===R||e===u)&&((m=n[u])[h]||(m[h]=[...te(s[u],h)||te(s[R],h)||[]]),n[u][h].push([r,i-d+o+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(c(this,k)).concat(Object.keys(c(this,W))).forEach(t=>{e[t]||(e[t]=E(this,Te,pt).call(this,t))}),f(this,W,f(this,k,void 0)),Gt(),e}},W=new WeakMap,k=new WeakMap,Te=new WeakSet,pt=function(e){const t=[];let r=e===R;return[c(this,W),c(this,k)].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==R&&t.push(...Object.keys(s[R]).map(i=>[i,s[R][i]]))}),r?Yt(t):null},Ye),z,q,Je,Xt=(Je=class{constructor(e){p(this,"name","SmartRouter");g(this,z,[]);g(this,q,[]);f(this,z,e.routers)}add(e,t,r){if(!c(this,q))throw new Error(ct);c(this,q).push([e,t,r])}match(e,t){if(!c(this,q))throw new Error("Fatal error");const r=c(this,z),s=c(this,q),n=r.length;let i=0,a;for(;i<n;i++){const l=r[i];try{for(let o=0,d=s.length;o<d;o++)l.add(...s[o]);a=l.match(e,t)}catch(o){if(o instanceof lt)continue;throw o}this.match=l.match.bind(l),f(this,z,[l]),f(this,q,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(c(this,q)||c(this,z).length!==1)throw new Error("No active router has been determined yet.");return c(this,z)[0]}},z=new WeakMap,q=new WeakMap,Je),ue=Object.create(null),V,j,Q,le,_,L,G,Xe,mt=(Xe=class{constructor(e,t,r){g(this,L);g(this,V);g(this,j);g(this,Q);g(this,le,0);g(this,_,ue);if(f(this,j,r||Object.create(null)),f(this,V,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},f(this,V,[s])}f(this,Q,[])}insert(e,t,r){f(this,le,++Le(this,le)._);let s=this;const n=St(t),i=[];for(let a=0,l=n.length;a<l;a++){const o=n[a],d=n[a+1],h=Dt(o,d),u=Array.isArray(h)?h[0]:o;if(u in c(s,j)){s=c(s,j)[u],h&&i.push(h[1]);continue}c(s,j)[u]=new mt,h&&(c(s,Q).push(h),i.push(h[1])),s=c(s,j)[u]}return c(s,V).push({[e]:{handler:r,possibleKeys:i.filter((a,l,o)=>o.indexOf(a)===l),score:c(this,le)}}),s}search(e,t){var l;const r=[];f(this,_,ue);let n=[this];const i=Ze(t),a=[];for(let o=0,d=i.length;o<d;o++){const h=i[o],u=o===d-1,m=[];for(let x=0,S=n.length;x<S;x++){const v=n[x],y=c(v,j)[h];y&&(f(y,_,c(v,_)),u?(c(y,j)["*"]&&r.push(...E(this,L,G).call(this,c(y,j)["*"],e,c(v,_))),r.push(...E(this,L,G).call(this,y,e,c(v,_)))):m.push(y));for(let O=0,ee=c(v,Q).length;O<ee;O++){const de=c(v,Q)[O],I=c(v,_)===ue?{}:{...c(v,_)};if(de==="*"){const $=c(v,j)["*"];$&&(r.push(...E(this,L,G).call(this,$,e,c(v,_))),f($,_,I),m.push($));continue}const[Se,Me,he]=de;if(!h&&!(he instanceof RegExp))continue;const N=c(v,j)[Se],wt=i.slice(o).join("/");if(he instanceof RegExp){const $=he.exec(wt);if($){if(I[Me]=$[0],r.push(...E(this,L,G).call(this,N,e,c(v,_),I)),Object.keys(c(N,j)).length){f(N,_,I);const Ae=((l=$[0].match(/\//))==null?void 0:l.length)??0;(a[Ae]||(a[Ae]=[])).push(N)}continue}}(he===!0||he.test(h))&&(I[Me]=h,u?(r.push(...E(this,L,G).call(this,N,e,I,c(v,_))),c(N,j)["*"]&&r.push(...E(this,L,G).call(this,c(N,j)["*"],e,I,c(v,_)))):(f(N,_,I),m.push(N)))}}n=m.concat(a.shift()??[])}return r.length>1&&r.sort((o,d)=>o.score-d.score),[r.map(({handler:o,params:d})=>[o,d])]}},V=new WeakMap,j=new WeakMap,Q=new WeakMap,le=new WeakMap,_=new WeakMap,L=new WeakSet,G=function(e,t,r,s){const n=[];for(let i=0,a=c(e,V).length;i<a;i++){const l=c(e,V)[i],o=l[t]||l[R],d={};if(o!==void 0&&(o.params=Object.create(null),n.push(o),r!==ue||s&&s!==ue))for(let h=0,u=o.possibleKeys.length;h<u;h++){const m=o.possibleKeys[h],x=d[o.score];o.params[m]=s!=null&&s[m]&&!x?s[m]:r[m]??(s==null?void 0:s[m]),d[o.score]=!0}}return n},Xe),Z,Qe,Qt=(Qe=class{constructor(){p(this,"name","TrieRouter");g(this,Z);f(this,Z,new mt)}add(e,t,r){const s=tt(t);if(s){for(let n=0,i=s.length;n<i;n++)c(this,Z).insert(e,s[n],r);return}c(this,Z).insert(e,t,r)}match(e,t){return c(this,Z).search(e,t)}},Z=new WeakMap,Qe),gt=class extends dt{constructor(e={}){super(e),this.router=e.router??new Xt({routers:[new Jt,new Qt]})}},Zt=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),n=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,l){var h;function o(u,m){a.res.headers.set(u,m)}const d=await s(a.req.header("origin")||"",a);if(d&&o("Access-Control-Allow-Origin",d),r.credentials&&o("Access-Control-Allow-Credentials","true"),(h=r.exposeHeaders)!=null&&h.length&&o("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&o("Vary","Origin"),r.maxAge!=null&&o("Access-Control-Max-Age",r.maxAge.toString());const u=await n(a.req.header("origin")||"",a);u.length&&o("Access-Control-Allow-Methods",u.join(","));let m=r.allowHeaders;if(!(m!=null&&m.length)){const x=a.req.header("Access-Control-Request-Headers");x&&(m=x.split(/\s*,\s*/))}return m!=null&&m.length&&(o("Access-Control-Allow-Headers",m.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await l(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}},er=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Ue=(e,t=rr)=>{const r=/\.([a-zA-Z0-9]+?)$/,s=e.match(r);if(!s)return;let n=t[s[1]];return n&&n.startsWith("text")&&(n+="; charset=utf-8"),n},tr={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},rr=tr,sr=(...e)=>{let t=e.filter(n=>n!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),s=[];for(const n of r)n===".."&&s.length>0&&s.at(-1)!==".."?s.pop():n!=="."&&s.push(n);return s.join("/")||"."},Et={br:".br",zstd:".zst",gzip:".gz"},nr=Object.keys(Et),ir="index.html",ar=e=>{const t=e.root??"./",r=e.path,s=e.join??sr;return async(n,i)=>{var h,u,m,x;if(n.finalized)return i();let a;if(e.path)a=e.path;else try{if(a=decodeURIComponent(n.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(a))throw new Error}catch{return await((h=e.onNotFound)==null?void 0:h.call(e,n.req.path,n)),i()}let l=s(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(a):a);e.isDir&&await e.isDir(l)&&(l=s(l,ir));const o=e.getContent;let d=await o(l,n);if(d instanceof Response)return n.newResponse(d.body,d);if(d){const S=e.mimes&&Ue(l,e.mimes)||Ue(l);if(n.header("Content-Type",S||"application/octet-stream"),e.precompressed&&(!S||er.test(S))){const v=new Set((u=n.req.header("Accept-Encoding"))==null?void 0:u.split(",").map(y=>y.trim()));for(const y of nr){if(!v.has(y))continue;const O=await o(l+Et[y],n);if(O){d=O,n.header("Content-Encoding",y),n.header("Vary","Accept-Encoding",{append:!0});break}}}return await((m=e.onFound)==null?void 0:m.call(e,l,n)),n.body(d)}await((x=e.onNotFound)==null?void 0:x.call(e,l,n)),await i()}},or=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let s;t&&t.namespace?s=t.namespace:s=__STATIC_CONTENT;const n=r[e]||e;if(!n)return null;const i=await s.get(n,{type:"stream"});return i||null},cr=e=>async function(r,s){return ar({...e,getContent:async i=>or(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,s)},lr=e=>cr(e);const w=new gt;w.use("/api/*",Zt());w.use("/static/*",lr({root:"./"}));w.get("/api/properties",async e=>{const t=e.env.DB,{results:r}=await t.prepare(`
    SELECT * FROM properties ORDER BY id DESC
  `).all();return e.json(r)});w.get("/api/properties/:id",async e=>{const t=e.env.DB,r=e.req.param("id"),s=await t.prepare(`
    SELECT * FROM properties WHERE id = ?
  `).bind(r).first();return s?e.json(s):e.json({error:"Property not found"},404)});w.post("/api/properties",async e=>{const t=e.env.DB,{name:r,address:s}=await e.req.json(),n=await t.prepare(`
    INSERT INTO properties (name, address) VALUES (?, ?)
  `).bind(r,s).run();return e.json({id:n.meta.last_row_id,name:r,address:s})});w.put("/api/properties/:id",async e=>{const t=e.env.DB,r=e.req.param("id"),{name:s,address:n}=await e.req.json();return await t.prepare(`
    UPDATE properties SET name = ?, address = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?
  `).bind(s,n,r).run(),e.json({id:r,name:s,address:n})});w.delete("/api/properties/:id",async e=>{const t=e.env.DB,r=e.req.param("id");return await t.prepare("DELETE FROM properties WHERE id = ?").bind(r).run(),e.json({success:!0})});w.get("/api/properties/:propertyId/rooms",async e=>{const t=e.env.DB,r=e.req.param("propertyId"),{results:s}=await t.prepare(`
    SELECT * FROM rooms WHERE property_id = ? ORDER BY room_number
  `).bind(r).all();return e.json(s)});w.post("/api/rooms",async e=>{const t=e.env.DB,{property_id:r,room_number:s,floor:n}=await e.req.json(),i=await t.prepare(`
    INSERT INTO rooms (property_id, room_number, floor) VALUES (?, ?, ?)
  `).bind(r,s,n).run();return e.json({id:i.meta.last_row_id,property_id:r,room_number:s,floor:n})});w.put("/api/rooms/:id",async e=>{const t=e.env.DB,r=e.req.param("id"),{room_number:s,floor:n}=await e.req.json();return await t.prepare(`
    UPDATE rooms SET room_number = ?, floor = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?
  `).bind(s,n,r).run(),e.json({id:r,room_number:s,floor:n})});w.delete("/api/rooms/:id",async e=>{const t=e.env.DB,r=e.req.param("id");return await t.prepare("DELETE FROM rooms WHERE id = ?").bind(r).run(),e.json({success:!0})});w.get("/api/rooms/:roomId/contracts",async e=>{const t=e.env.DB,r=e.req.param("roomId"),{results:s}=await t.prepare(`
    SELECT * FROM contracts WHERE room_id = ? ORDER BY created_at DESC
  `).bind(r).all();return e.json(s)});w.get("/api/properties/:propertyId/active-contracts",async e=>{const t=e.env.DB,r=e.req.param("propertyId"),{results:s}=await t.prepare(`
    SELECT c.*, r.room_number, r.floor 
    FROM contracts c
    JOIN rooms r ON c.room_id = r.id
    WHERE r.property_id = ? AND c.is_active = 1
    ORDER BY r.room_number
  `).bind(r).all();return e.json(s)});w.post("/api/contracts",async e=>{const t=e.env.DB,{room_id:r,contractor_name:s,tenant_name:n,rent:i,management_fee:a,parking_fee:l,other_fee:o,start_date:d,end_date:h,is_active:u}=await e.req.json(),m=await t.prepare(`
    INSERT INTO contracts (room_id, contractor_name, tenant_name, rent, management_fee, parking_fee, other_fee, start_date, end_date, is_active)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  `).bind(r,s,n||null,i,a,l,o,d,h||null,u).run();return e.json({id:m.meta.last_row_id})});w.put("/api/contracts/:id",async e=>{const t=e.env.DB,r=e.req.param("id"),{contractor_name:s,tenant_name:n,rent:i,management_fee:a,parking_fee:l,other_fee:o,start_date:d,end_date:h,is_active:u}=await e.req.json();return await t.prepare(`
    UPDATE contracts 
    SET contractor_name = ?, tenant_name = ?, rent = ?, management_fee = ?, parking_fee = ?, other_fee = ?, start_date = ?, end_date = ?, is_active = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `).bind(s,n||null,i,a,l,o,d,h||null,u,r).run(),e.json({success:!0})});w.delete("/api/contracts/:id",async e=>{const t=e.env.DB,r=e.req.param("id");return await t.prepare("DELETE FROM contracts WHERE id = ?").bind(r).run(),e.json({success:!0})});w.get("/api/properties/:propertyId/expenses",async e=>{const t=e.env.DB,r=e.req.param("propertyId"),s=e.req.query("year_month");let n="SELECT * FROM expenses WHERE property_id = ?";const i=[r];s&&(n+=" AND year_month = ?",i.push(s)),n+=" ORDER BY created_at DESC";const{results:a}=await t.prepare(n).bind(...i).all();return e.json(a)});w.post("/api/expenses",async e=>{const t=e.env.DB,{property_id:r,year_month:s,item_name:n,description:i,amount:a,tax:l,total:o}=await e.req.json(),d=await t.prepare(`
    INSERT INTO expenses (property_id, year_month, item_name, description, amount, tax, total)
    VALUES (?, ?, ?, ?, ?, ?, ?)
  `).bind(r,s,n,i||null,a,l,o).run();return e.json({id:d.meta.last_row_id})});w.put("/api/expenses/:id",async e=>{const t=e.env.DB,r=e.req.param("id"),{item_name:s,description:n,amount:i,tax:a,total:l}=await e.req.json();return await t.prepare(`
    UPDATE expenses 
    SET item_name = ?, description = ?, amount = ?, tax = ?, total = ?, updated_at = CURRENT_TIMESTAMP
    WHERE id = ?
  `).bind(s,n||null,i,a,l,r).run(),e.json({success:!0})});w.delete("/api/expenses/:id",async e=>{const t=e.env.DB,r=e.req.param("id");return await t.prepare("DELETE FROM expenses WHERE id = ?").bind(r).run(),e.json({success:!0})});w.get("/api/properties/:propertyId/report",async e=>{const t=e.env.DB,r=e.req.param("propertyId"),s=e.req.query("year_month")||new Date().toISOString().slice(0,7),n=await t.prepare(`
    SELECT * FROM properties WHERE id = ?
  `).bind(r).first();if(!n)return e.json({error:"Property not found"},404);const{results:i}=await t.prepare(`
    SELECT c.*, r.room_number, r.floor 
    FROM contracts c
    JOIN rooms r ON c.room_id = r.id
    WHERE r.property_id = ? AND c.is_active = 1
    ORDER BY r.room_number
  `).bind(r).all(),{results:a}=await t.prepare(`
    SELECT * FROM expenses WHERE property_id = ? AND year_month = ?
    ORDER BY created_at
  `).bind(r,s).all(),l=i.reduce((h,u)=>h+(u.rent||0)+(u.management_fee||0)+(u.parking_fee||0)+(u.other_fee||0),0),o=a.reduce((h,u)=>h+(u.total||0),0),d=l-o;return e.json({property:n,year_month:s,report_date:new Date().toISOString().split("T")[0],contracts:i,expenses:a,total_income:l,total_expense:o,net_income:d})});w.get("/",e=>e.html(`
    <!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>不動産月次収支報告書システム</title>
        <script src="https://cdn.tailwindcss.com"><\/script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    </head>
    <body class="bg-gray-50">
        <div id="app"></div>
        
        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"><\/script>
        <script src="/static/app.js"><\/script>
    </body>
    </html>
  `));const We=new gt,dr=Object.assign({"/src/index.tsx":w});let vt=!1;for(const[,e]of Object.entries(dr))e&&(We.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),We.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),vt=!0);if(!vt)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{We as default};
